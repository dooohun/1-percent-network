# Story 1)  HTTP 리퀘스트 메시지를 작성한다.

## 1. URL 입력

URL은 우리가 알고 있는 http 뿐만 아니라 ftp, file 등 여러가지 존재한다. 다양한 URL이 준비되어 있는 것은 이유가 있다. 브라우저는 몇 개의 클라이언트 기능을 겸비한 복합적인 클라이언트 소프트웨어이다. 그렇기 때문에 어느 기능을 사용하는지에 따라 다양한 URL이 준비되어 있고, URL에 명시된 프로토콜로 기능을 판단할 수 있다.

URL에 액세스 대상마다 서로 다른 정보를 담는다. 웹 서버의 요청일 경우 도메인명, 파일의 경로, 포트 번호 등을 담아서 보낼 수 있다. 공통적으로 모든 URL 앞에 액세스 대상에 따라 다른 프로토콜을 사용한다.

<img src="https://velog.velcdn.com/images/ehgns0305/post/7606eb0a-b52f-497c-ae6f-800c5bd2afdb/image.png">

**각종 URL의 형식**

## 2. 브라우저의 URL 해독

브라우저는 리퀘스트 메시지를 작성하기 위해 URL을 해독한다. 슬래시(/)를 기준으로 디렉토리 구조와 파일명을 명시하여 URL에 포함한다.

세 가지를 경우를 통해 더 알아보자.

**1) 마지막에 파일명을 명시하지 않은 경우**

파일명을 미리 서버 측에서 설정해 두는데 서버에 따라 index.html, default.htm이라는 파일에 액세스한다.

**2) 마지막에 디렉토리를 생략한 경우**

명시하지 않는 경우와 마찬가지로 index.html, default.htm 파일에 액세스한다.

**3) 마지막 경로에 /가 생략된 경우**

경로명이 아무 것도 없는 경우에는 루트 디렉토리의 아래에 있는 미리 설정된 파일명의 파일에 액세스한다.  http://www.lab.cyber.co.kr/whatisthis 이 예는 매칭되는 파일명이 있는지 확인하고, 없다면 매칭되는 디렉토리명이 있는지 확인한다.

## 3. HTTP의 기본 개념

URL을 해독하면 어디에 액세스해야 하는 지가 판명된다. 그러고 나면 브라우저는 HTTP 프로토콜을 사용하여 웹 서버에 액세스하게 된다. HTTP 프로토콜은 클라이언트와 서버가 주고받는 메시지의 내용이나 순서를 정한 것이다. 클라이언트가 서버를 향해 보내는 리퀘스트 메시지에 대해 알아보겠습니다.

리퀘스트 메시지는 ‘무엇을’, ‘어떻게 해서’의 내용이 쓰여 있다. ‘무엇을’에 해당하는 것은 URI(Uniform Resource Idenifier)로, 페이지 데이터를 저장한 파일의 이름이나 CGI 프로그램의 파일명을 URI로 작성한다.

‘어떻게 해서’에 해당하는 것은 메소드로, 메소드에 의해 웹 서버에 어떤 동작을 하고 싶은지를 전달한다. 대표적으로는 “URI로 나타낸 데이터를 읽고 싶다” 혹은 “입력한 데이터를 URI로 나타낸 프로그램에 전달하고 싶다” 식의 동작이 있다.

<img src="https://velog.velcdn.com/images/ehgns0305/post/79d4ad11-354a-4a50-8bf1-ef4602f935c1/image.png">

**주요 메소드 표**


리퀘스트 메시지가 웹 서버에 도착하면 웹 서버는 내용을 해독하고 요구에 따라 동작 후 결과 데이터를 응답 메시지에 저장하게 된다. 응답 메시지의 맨 앞부분에는 실행 결과의 상태를 나타내는 스테이터스 코드가 있다. 그 후 헤더 파일과 페이지의 데이터가 이어지고, 응답 메시지를 클라이언트에 반송하게 된다.

## 4. HTTP 리퀘스트 메시지의 구조

URL을 해독하고 웹 서버와 파일명을 판단하면 브라우저는 이것을 바탕으로 HTTP 리퀘스트 메시지를 만든다. 리퀘스트 메시지의 구조에 대해 알아보겠습니다.
	

 - **리퀘스트 메시지의 첫 번째 행 – 리퀘스트 라인**

	리퀘스트 라인은 메소드, URI, HTTP 버전으로 이루어져 있다. 이 행에서 중요한 것은 맨 앞에 있는 메소드이다. 이것을 통해 웹 브라우저는 웹 서버에 어떻게 할 것인지를 전달한다. 메소드에는 여러 종류가 있으므로 어느 메소드를 사용할지에 대한 판단이 중요하다. 예를 들어 URL을 입력하면 해당 페이지를 표시하므로 GET 메소드를 사용하고, 폼에 데이터를 기입하여 송신 버튼을 누를 때 POST 메소드를 사용한다.

	

 - **리퀘스트 메시지의 두 번째 행부터 공백 라인 전까지 – 메시지 헤더**

	부가적인 자세한 정보를 갖고 있다. 날짜, 클라이언트 측이 취급하는 데이터의 종류, 언어, 압축 형식, 클라이언트나 서버의 소프트웨어 명칭과 버전, 데이터의 유효 기간이나 최종 변경 일시 등 다수의 항목이 사양으로 정해져 있다.

 - **공백 라인 이후 – 메시지 본문**

	메시지 본문은 GET메소드와 POST 메소드가 각각 내용이 다르다. GET 메소드는 메소드와 URI만으로 웹 서버가 무엇을 할지 판단 가능하므로 메시지 본문에는 아무 것도 없다. 반면 POST 메소드는 폼에 입력한 데이터 등을 메시지 본문 부분에 쓴다. 이로써 리퀘스트 메시지 작성이 완료된다.

## 5. 응답 메시지

응답 메시지의 포맷도 기본적인 개념은 리퀘스트 메시지와 같다. 단 첫 번째 행이 다르다. 리퀘스트의 실행 결과를 나타내는 스테이터스 코드와 응답 문구를 첫 번째 행에 써야한다. 스테이터스 코드는 숫자로 쓴 것이며, 주로 프로그램 등에 실행 결과를 알려주는 목적이다.

<img src="https://velog.velcdn.com/images/ehgns0305/post/b67fe93a-562d-4894-b93a-181ec879c4f4/image.png">

**HTTP 스테이터스 코드 개요**

응답이 오면 메시지를 추출해서 화면에 표시한다. 그러나 문장만으로 이루어진 응답 데이터가 아닌 경우 즉 영상, 이미지가 포함되어 있는 경우 해당 파일을 나타내는 태그라는 제어 정보가 포함되어 있어 브라우저는 화면에 문장을 표시할 때 태그를 탐색한다. 태그가 존재한다면 우선 공백으로 비워 두고 문장을 표시한다. 그리고 추가 웹 서버 액세스하여 태그에 쓰여 있는 경로로 URI를 만들어 리퀘스트 메시지를 만들어 보낸다.

리퀘스트 메시지에 쓰는 URI는 한 개만으로 결정되어 있으므로 파일을 한 번에 한 개씩만 읽을 수 있기 때문에 파일을 따로 읽어야 한다.

# Story 2) 웹 서버의 IP 주소를 DNS 서버에 조회한다.

## 1. IP 주소의 기본

브라우저는 URL을 해독하거나 HTTP 메시지를 만들지만, 메시지를 네트워크에 송출하는 기능은 없으므로 OS에 의뢰하여 송신한다. OS에 송신을 의뢰할 때는 도메인명이 아니라 IP 주소로 메시지를 받을 상대를 지정해야 하기 때문에 IP 주소를 조사해야 한다.

 - TCP/IP

	서브넷이라는 작은 네트워크를 라우터로 접속하여 전체 네트워크가 만들어진다. 서브넷이란 허브에 몇 대의 PC가 접속된 것이라고 생각하면 된다. 이것을 한 개의 단위로 생각하여 서브넷이라고 부르는데, 라우터에서 연결하면 네트워크 전체가 완성된다.

	네트워크 주소를 “00동 00번지”의 단위로 표현이 가능한데, 00동은 서브넷에 할당된 네트워크 번호를 뜻하며 00번는 호스트 번호라고 한다. 이 두 주소를 합쳐서 IP 주소라고 한다. IP 주소에 따라 액세스 대상이 어디에 있는지 판단하고 운반한다.
	
	송신측이 메시지를 보내면 가까운 허브가 운반하여 가까운 라우터로 이동에 송신한다. 라우터에서 다음 라우터를 판단하고 서브넷의 허브가 해당 라우터까지 메시지를 송신한다. 이 과정을 반복하여 최종 도착지에 데이터가 도착하게 된다.

<img src="https://velog.velcdn.com/images/ehgns0305/post/610e5e05-2f57-4ef6-be20-d867cfda44a5/image.png">

**IP의 기본 개념**

- IP 구조

	IP 주소는 32비트의 디지털 데이터로 8비트씩 점으로 구분하여 10진수로 표현한다. IP 주소는 네트워크 번호와 호스트 번호를 합쳐서 표현한 것인데, 문제는 이 둘의 구분점이 없다는 점이다. 그렇기 때문에 네트워크 번호와 호스트 번호를 판단하기 위해 **넷마스크** 정보를 IP 주소에 덧붙인다.

	넷마스크는 IP 주소에서 32비트 부분의 디지털 데이터이다. 10진수 표기를 비트로 고치면 1로 표기된 값과 0으로 표기된 값으로 나뉘는데 각각 1은 네트워크 번호이고, 0은 호스트 번호이다. 특수한 경우가 있는데, 호스트 번호 부분의 비트 값이 모두 0 또는 1인 경우가 그것이다. 호스트 번호가 0인 경우 서브넷 자체를 나타내고, 1인 경우 서브넷 기기 전체에 패킷을 보내는 브로드캐스트를 나타낸다.

## 2. 도메인명과 IP 주소를 구분하는 이유

TCP/IP 네트워크는 IP 주소로 통신 상대를 지정하므로 반드시 IP 주소가 있어야 수신 상대와 연결될 수 있다. 번호로 구성된 IP 주소는 기억하기 어렵기 때문에 도메인명을 사용하고 있다.

“도메인명으로 상대를 지정하여 통신하자” 라는 의견 생기기 시작했다. 그러나 실행 효율이라는 관점에서 보았을 때 좋은 방법이라고 할 수 없다. 도메인명은 문자를 취급하기 때문에 라우터가 부하되어 데이터를 운반하는 동작에 더 많은 시간이 걸리면서 네트워크 속도가 느려지게 된다.

따라서 사람은 이름을 사용하고, 라우터는 IP 주소를 사용한다는 방법이 고안되었고 현재 이 방법이 정착되어 있다. 이름을 알면 해당 IP 주소를 알아서 찾아주는 **DNS**  원리가 고안되었다.

## 3. Socket 라이브러리가 IP 주소를 찾는 기능 제공

IP 주소를 조사하는 방법은 매우 간단하다. 가장 가까운 DNS 서버에 물어보면 된다. 그렇다면 브라우저는 어떻게 해서 DNS 서버를 조회할 수 있을까?

IP 주소를 찾기 위해서는 DNS 서버에 조회 메시지를 보내고 거기에서 반송되는 응답 메시지를 받으면 된다. 이 DNS 클라이언트에 해당하는 것을 DNS 리졸버 또는 리졸버라고 부른다. 그리고 DNS 원리로 IP 주소를 조사하는 것을 네임 리졸루션(name resolution)이라고 한다. 리졸루션을 실행하는 것이 리졸버이다.

리졸버는 Socket 라이브러리에 내장된 프로그램이다. Socket 라이브러리에 대해 간단히 살펴보자. 소켓 라이브러리는 프로그래머가 네트워크 통신을 쉽게 구현할 수 있도록 도와주는 인터페이스를 제공한다. 이 라이브러리를 사용하면 네트워크 통신에 필요한 여러 기능과 API를 활용하여 서버와 클라이언트 간의 데이터 통신을 설정하고 관리할 수 있다.

## 4. 리졸버를 이용하여 DNS 서버를 조회

Socket 라이브러리에 들어있는 프로그램은 부품화되어 있고 애플리케이션에서 간단히 호출하여 이용할 수 있다. 리졸버의 프로그램명(gethostbyname)과 웹 서버의 이름을 쓰기만 하면 리졸버를 호출할 수 있다.


<img src="https://velog.velcdn.com/images/ehgns0305/post/387e8bcd-0c7f-46b2-ac97-960b668a7446/image.png">

**리졸버를 호출하는 방법**

## 5. 리졸버 내부의 작동

1. 브라우저가 리졸버를 호출하면 제어가 리졸버의 내부로 넘어간다.

> "제어가 넘어가다" 에 대해 보충 설명을 하면, 별도의 프로그램을 호출하여 호출처의 프로그램이 쉬고 있는 상태가 되며, 호출한 대상 프로그램이 움직이기 시작하는 것을 "제어가 넘어가다" 라고 표현한다.

3. 리졸버는 DNS에 문의하기 위한 메시지를 만든다.

4. 리졸버는 직접 메시지를 송신하는 기능을 가지고 있는 것이 아니다. 따라서, OS의 프로토콜 스택을 호출하여 실행을 의뢰합니다.

5. 프로토콜 스택이 LAN 어댑터를 통해 DNS 서버로 메시지를 송신한다.

6. DNS 서버가 IP 주소를 조회해 응답메시지를 보내준다.